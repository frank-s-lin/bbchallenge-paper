% !TeX root = bbchallenge-paper.tex

\title{Formal verification of the 5\textsuperscript{th} Busy Beaver value}
\author{
        bbchallenge's contributors
}

\documentclass[a4paper,british]{article}

\usepackage{babel}
\usepackage[utf8]{inputenc}
\usepackage[margin=1in]{geometry}
%\usepackage{subfig}
\usepackage[hidelinks]{hyperref}
\usepackage{caption}
\usepackage{floatpag}
\usepackage{subcaption}
\usepackage{tikz}

\usepackage{algorithm}
\usepackage[noend]{algpseudocode}

\usepackage{bold-extra}% bold texttt

\usepackage{graphicx}
\usepackage{mathtools}

\usepackage{amsmath,amsfonts,amssymb,amsthm}

\theoremstyle{definition} % don't use italics
\newtheorem{theorem}{Theorem}[section]
\newtheorem{definition}{Definition}[section]
\newtheorem{lemma}{Lemma}[section]
\newtheorem{proposition}{Proposition}[section]
\newtheorem{corollary}{Corollary}[section]
\numberwithin{equation}{section}


\theoremstyle{definition} % emphasize the "Remark N." with italics, not bold
\newtheorem{observation}{Observation}[section]
\newtheorem{example}{Example}[section]
\newtheorem{remark}{Remark}[section]

\usepackage{xassoccnt}
\DeclareCoupledCountersGroup{theorems}
\DeclareCoupledCounters[name=theorems]{theorem,definition,lemma,proposition,corollary,remark,observation,example}

\usepackage{microtype,xspace,wrapfig,multicol} 
\usepackage[textsize=tiny,color=lightgray]{todonotes} 
\usepackage[normalem]{ulem} % sout
\usepackage{stmaryrd}


\newcommand{\ts}[1]{{\color{red}#1}}
\newcommand{\tsi}[1]{\todo[inline]{TS: #1}}
\newcommand{\tsm}[1]{\todo{TS: #1}}
\newcommand{\tss}[2]{{\ts{\sout{#1}}} {\ts{#2}}}
\newcommand{\jb}[1]{{\color{blue}#1}}
\newcommand{\jbi}[1]{\todo[inline]{JB: #1}}
\newcommand{\jbm}[1]{\todo{JB: #1}}
\newcommand{\jbs}[2]{{\jb{\sout{#1}}} {\jb{#2}}}
\newcommand{\tabi}{\hspace{\algorithmicindent}}
\newcommand{\Lim}[1]{\raisebox{0.5ex}{\scalebox{0.8}{$\displaystyle \lim_{#1}\;$}}}
\newcommand{\N}{\mathbb{N}}
\newcommand{\Z}{\mathbb{Z}}

\newcommand{\lhead}[1]{\stackrel{#1}\triangleleft}
\newcommand{\rhead}[1]{\stackrel{#1}\triangleright}

\newcommand{\tm}[1]{\href{https://bbchallenge.org/#1}{\nolinkurl{#1}}}

\usepackage{xcolor}

\definecolor{colorA}{RGB}{255,0,0}
\definecolor{colorB}{RGB}{255,128,0}
\definecolor{colorC}{RGB}{0,0,255}
\definecolor{colorD}{RGB}{0,255,0}
\definecolor{colorE}{RGB}{255,0,255}

\newcommand{\stateA}{{\textcolor{colorA}{A}}\xspace}
\newcommand{\stateB}{{\textcolor{colorB}{B}}\xspace}
\newcommand{\stateC}{{\textcolor{colorC}{C}}\xspace}
\newcommand{\stateD}{{\textcolor{colorD}{D}}\xspace}
\newcommand{\stateE}{{\textcolor{colorE}{E}}\xspace}

\newcommand{\szero}{\texttt{0}\xspace}
\newcommand{\sone}{\texttt{1}\xspace}

\def\@fnsymbol#1{\ensuremath{\ifcase#1\or *\or \dagger\or \ddagger\or
   \mathsection\or \mathparagraph\or \|\or **\or \dagger\dagger
   \or \ddagger\ddagger \else\@ctrerr\fi}}
\newcommand{\ssymbol}[1]{^{\@fnsymbol{#1}}}

\newcommand{\BBtheFourth}{107}
\newcommand{\SigmaTheFourth}{13}
\newcommand{\BBtheFourthTNF}{\ts{???}}

\newcommand{\BBtheFifth}{47{,}176{,}870}
\newcommand{\BBtheFifthTNF}{181{,}385{,}789}
\newcommand{\SigmaTheFifth}{4{,}098}

\newcommand{\BBTxF}{3{,}932{,}974}
\newcommand{\BBTxFTNF}{\ts{???}}

\newcommand{\radofull}{Tibor Rad\'o\xspace}
\newcommand{\rado}{Rad\'o\xspace}

\newcommand{\cryptid}{Cryptid\xspace}

\newcommand{\cycler}{Cycler\xspace}
\newcommand{\cyclers}{Cyclers\xspace}
\newcommand{\TC}{Translated Cycler\xspace}
\newcommand{\TCs}{Translated Cyclers\xspace}

\newcommand{\headpos}{head-position\xspace}
\newcommand{\headposs}{head-positions\xspace}

\newcommand{\states}{\mathcal{S}}
\newcommand{\alphabet}{\mathcal{A}}
\newcommand{\symbolzero}{\texttt{0}}
\newcommand{\symbolone}{\texttt{1}}

\newcommand{\numSporadic}{\ts{XX}\xspace}

\newcommand{\ssp}{state-symbol-pair\xspace}
\newcommand{\ssps}{state-symbol-pairs\xspace}

\newcommand{\HALT}{\texttt{HALT}\xspace}
\newcommand{\NONHALT}{\texttt{NONHALT}\xspace}
\newcommand{\UNKNOWN}{\texttt{UNKNOWN}\xspace}

\newcommand{\CoqBB}{Coq-BB5\xspace}

\begin{document}
\date{}
\maketitle

\begin{abstract}
    ee
\end{abstract}


\setcounter{tocdepth}{2}
\tableofcontents
\newpage

\begin{center}

\end{center}



\begin{figure}
    \begin{quote}
        ``In any case, even though skilled mathematicians and experienced programmers attempted to evaluate $\Sigma(3)$ and S(3), there is no evidence that any known approach will yield the answer, even if we avail ourselves of high-speed computers and elaborate programs. As regards $\Sigma(4)$, $S(4)$ the situation seems to be entirely hopeless at present.'' --- \radofull, 1963 \cite{Rado_1963}
    \end{quote}
    \begin{quote}
        ``\textit{Prediction 5}. It will never be proved that $\Sigma(5) = \SigmaTheFifth$ and $S(5) = \BBtheFifth$.'' --- Allen H. Brady, 1990 \cite{BradyMeaningOfLife}
    \end{quote}
    \caption{\radofull, who invented the Busy Beaver game, proved the value of $S(2)$ in 1962 \cite{Rado_1962}, and was involved in the proof of $S(3)$ in 1963 \cite{Lin1963}, did not believe that $S(4)$ could be solved at his time. Allen H. Brady, who proved the value of $S(4)$ in 1983 \cite{Brady83}, did not believe that $S(5)$ could be solved at all. Amusingly, Brady opens his article on $S(4)$ with \rado's above quote \cite{Brady83}. Under that light, the knowledge of a (small) Busy Beaver value seems to be a reflection of the computing technology available at the time it was proved.}
\end{figure}

\section{Introduction}

\subsection{Main Results}\label{sec:intro:mainresults}

\newcommand{\noncomput}{noncomputable\xspace}
\newcommand{\BBfull}{Busy Beaver\xspace}
\newcommand{\Coq}{Coq\xspace}
% We'll update this link to v1 release URL
\newcommand{\CoqProofReleaseURL}{\url{https://github.com/ccz181078/Coq-BB5}}

\newcommand{\ie}{i.e.~}
\newcommand{\eg}{e.g.~}

In 1962, \radofull introduced \textit{the \BBfull game} in an effort to ``present some very simple instances of \noncomput functions'' \cite{Rado_1962}. The game is as such: (i) run all $n$-state Turing machines\footnote{See Appendix~\ref{app:TMs} for Turing machines definitions and examples.} from the all-zero tape (ii) consider the set of machines that eventually halt (iii) the winner of the game is the halting machine that has the most \sone symbols on its tape when it halts. This maximum number of \sone symbols on halting tape among $n$-state machines is called $\Sigma(n)$. \rado also introduced $S(n)$, the maximum number of steps made by a halting $n$-state Turing machine from all-zero tape. Both functions $\Sigma$ and $S$ are \noncomput! This is most obvious in the case of $S$: if an $n$-state machine runs for more than $S(n)+1$ steps, we know it will never halt, giving an algorithm to decide Turing's halting problem if $S$ was computable. This tight link between $S$ and the halting problem makes it more interesting and practical to us than $\Sigma$, hence we take the liberty (similarly to other authors \cite{BusyBeaverFrontier,otherexamples?}) to concentrate more on $S$.

%This tight link to the halting problem makes $S$ more interesting and practical to us than $\Sigma$, hence we take the liberty (similarly to other authors \cite{BusyBeaverFrontier,otherexamples?}) to focus the busy beaver game on $S$ instead of $\Sigma$ and to call the $n$-state \textit{busy beaver winner} the machine achieving $S(n)$ running steps. 
Prior to this work, only the four first values of $S$ had been proved: $S(1)=1$, $S(2)=6$ \cite{Rado_1962}, $S(3) = 21$ \cite{Lin1963}, $S(4) = 107$ \cite{Brady83}. With some early attempts in the 1960s and 1970s, the $S(5)$ quest seriously started in 1983 with a 2-day competition organised at the University of Dortmund\footnote{Report of the competition: \url{https://docs.bbchallenge.org/other/lud20.pdf}.} with the sole goal of finding new 5-state champions -- \ie 5-state machines achieving better $S$ scores than any machines previously known \cite{PMichel_website,michel2019busy}. The winning machine in Dortmund achieved $134,467$ steps, establishing $S(5) \geq 134,467$. A big step was then made in 1989 when Marxen and Buntrock found a new champion\footnote{\url{https://bbchallenge.org/1RB1LC_1RC1RB_1RD0LE_1LA1LD_1RZ0LA} \ts{TS: (to improve with table)}} achieving $\BBtheFifth$ steps \cite{Marxen_1990}, showing $S(5) \geq \BBtheFifth$. However, it remained unknown if no other machine could beat it, \ie whether Marxen and Buntrock's 5-state machine was the actual winner or not. In 2020, Aaronson conjectured that there is no better 5-state machine, \ie $S(5) = \BBtheFifth$ \cite{BusyBeaverFrontier}.

Our main result is to prove this conjecture, using the \Coq theorem prover \cite{the_coq_development_team_2024_14542673}, see Theorem~\ref{th:BB5}. The winning machine for $S(5)$ is also the winning machine for $\Sigma(5)$. We prove $\Sigma(5) = \SigmaTheFifth$, see Theorem~\ref{th:BB5Sigma}.

\begin{theorem}\label{th:BB5}
    $S(5) = \BBtheFifth$.
\end{theorem}

The function $S$ can naturally be extended to Turing machines using more than two alphabet symbols \cite{BradyMeaningOfLife}, like, for instance, $S(2,3) = 38$ is the value of $S$ for 2-state, 3-symbol machines \cite{BradyMeaningOfLife, MICHEL200445, LafittePapazian2007}. We also prove, using the Coq theorem prover \cite{the_coq_development_team_2024_14542673}, that $S(2,4) = \BBTxF$, see Theorem~\ref{th:BB2x4}:

\begin{theorem}\label{th:BB2x4}
    $S(2,4) = \BBTxF$.
\end{theorem}

The Coq proofs are available at \url{https://github.com/ccz181078/Coq-BB5}. The goal of this paper is to present these proofs. As a result of our work, we now have a clearer view of the small Busy Beaver values landscape, see Table~\ref{table:landscape}.



\begin{table}[]
    \centering
    \begin{tabular}{llllll}
                 & 2-state                                                       & 3-state                                        & 4-state                                   & 5-state                            & 6-state                                                    \\
        2-symbol & $S(2) = 6$ \cite{Rado_1962}                                   & $S(3) = 21$ \cite{Lin1963}                     & $S(4) = 107$ \cite{Brady83}               & $S(5) = \BBtheFifth \ssymbol{2}\ $ & $S(6) > 10 \uparrow \uparrow 15 \ssymbol{1}\ \ssymbol{3} $ \\
        3-symbol & $S(2,3) = 38$ \cite{LafittePapazian2007}                      & $S(3,3) > {10^{17}} \ssymbol{1}\ \ssymbol{3} $ & $S(4,3) > {10^{14{,}072}} \ssymbol{1}\  $ &                                    &                                                            \\
        4-symbol & $S(2,4) = \BBTxF \ssymbol{2}$                                 & $S(3,4) > 2 \uparrow^{15} 5 \ssymbol{1}\ $     &                                           &                                    &                                                            \\
        5-symbol & $S(2,5) > 10 \uparrow \uparrow {4 \ssymbol{1}} \ssymbol{3}\ $ &                                                &                                           &                                    &
    \end{tabular}
    \caption{Landscape of small busy beaver values. $\ssymbol{2}\ $ proved in this work using the \Coq theorem prover. $\ssymbol{1}\ $ lower bounds, see Appendix~\ref{app:lowerbounds}. $\ssymbol{3}\ $ existence of a \textit{\cryptid}, see Appendix~\ref{app:cryptids}.}\label{table:landscape}
\end{table}


\paragraph{Challenges.} Proving $S(5) = \BBtheFifth$ required analyzing the behavior of $\BBtheFifthTNF$ Turing machines\footnote{This exact number can only be known after the proof is done, see Section~\ref{sec:TNF}.}-- evidently requiring computer assistance. The challenge for a halting machine is the case where it halts after a number of steps that is too enormous to be simulated step-by-step (e.g. the current 6-state champion halts after $10 \uparrow \uparrow 15$ steps \cite{Pavel_discorvery}, see Appendix~\ref{app:lowerbounds}), this challenge was not met for 5-state machines since they halt in at most $\BBtheFifth$ steps -- this could not have been known for certain in advance but was believed -- which is easy to simulate on modern computers. The challenge for a non-halting machine is that proving it does halt can be hard. How hard?

Dauntingly, any $\Pi_1^0$ mathematical statement\footnote{A $\Pi_1^0$ statement is a statement of first-order logic of the form ``$\forall x, \phi(x)$'' where $\phi$ is a sentence with only bounded quantifiers (\ie $\phi(x)$ can always be verified by a computer in finite time).} can be encoded as the halting problem of a Turing machine (from all-zero tape). Such statements are common and include famous open problems in mathematics such as Goldbach's conjecture or the Riemann hypothesis. Goldbach's conjecture, formulated in 1742, is one of the oldest open problems in mathematics and states ``every even positive integer greater than 2 is the sum of two prime numbers.'' We can build a Turing machine that halts iff the conjecture is false: by enumerating all positive integers, then for each, test all sums of smaller primes and halt iff we do not find the sum. A (formally verified) machine performing this procedure has been built using only 25 states \cite{GoldbachTM27, GoldbachTM25}. This means that proving the value of $S(25)$ is at least as hard as solving Goldbach's conjecture because the proof of $S(25)$ must contain an argument as of why this particular 25-state machine does not (or, believed less likely, does) halt. Similarly, the Riemann hypothesis has been encoded in a 744-state machine \cite{RiemannTM,Yedidia2016,BusyBeaverFrontier}. As low as 15 states is enough to encode a hard number theoretical conjecture by Erd\H{o}s \cite{BB15}. Worst, the consistency of common axioms sets such as Peano's Arithmetic (PA) or Zermeloâ€“Fraenkel set theory (ZF) is also $\Pi_1^0$ since one can enumerate proofs in these systems until the proof of a contradiction is found. This has been done for ZF, using 748 states \cite{ZFTM,Yedidia2016,BusyBeaverFrontier,BB748Thesis}. By G\"odel's second incompleteness theorem, this means that proving the value of $S(748)$ cannot be done using ZF. Aaronson conjectures that as low as $S(20)$ cannot be proven in ZF and as low as $S(10)$ cannot be proven in PA \cite{BusyBeaverFrontier}.

Hence, while 5-state halting machines were not feared, it remained unknown how hard non-halting 5-state machines could get. This article settles the question.

\paragraph{Related Work.} The proof of $S(4) = \BBtheFourth$ was published in 1983 \cite{Brady83}. One of its main innovations was the introduction of a method to solve the halting problem of a category of machines the author calls \textit{XMas Trees}. A caveat of \cite{Brady83} resides in the following quote from the paper: ``All of the remaining holdouts were examined by means of voluminous printouts of their histories along with some program extracted features. It was determined to the author's satisfaction that none of these machines will ever stop.'' A \textit{holdout} is a machine still needing a proof of halting/nonhalting. Using the Coq theorem prover, we bring additional confirmation that $S(4) = \BBtheFourth$, see Theorem~\ref{th:BB4}.

\newcommand{\SkeletHoldoutsSporadic}{\ts{XX}\xspace}

We know of two attempts at solving $S(5)$: in 2003, Georgi Georgiev (also known under pseudonym ``Skelet'' or ``Skeleta'') published the program \texttt{bbfind} \cite{Skelet_bbfind} which enumerates and decides the halting behavior of 5-state Turing machines, claiming to leave unsolved mainly 43 holdouts\footnote{\url{https://skelet.ludost.net/bb/nreg.html} and \url{https://bbchallenge.org/skelet}}. Attesting to the validity of the result is difficult as Skelet's code consists of ca. 6000 lines of uncommented and undocumented Pascal. That said, it turned out to be instrumental for our result as, after reverse engineering parts of it, we were able to learn and improve on his ``Closed Position Set'' technique (see Section~\ref{sec:n-gramCPS}) which improvements decided slightly more than 99.87\% of the 5-state Turing machines excluding loops (see Section~\ref{sec:loops}). \SkeletHoldoutsSporadic of his 43 holdouts ended up being \textit{sporadic machines}, \ie machines for which we needed individual proofs of nonhalting, including the particularly difficult machines Skelet \#1 and Skelet \#17. See Section~\ref{sec:sporadic} for more discussion on our analyses of these longstanding holdouts. Some of Skelet's list of 43 holdouts were analysed by hand prior to our work \cite{DanBriggs}. The second known attempt at $S(5)$ was in 2008 with Joachim Hertel's ``Symbolic induction prover'', which claimed to leave only $1{,}000$ holdouts, $900$ of which were manually proven not to halt, allegedly leaving only $100$ proper holdouts \cite{Hertel}. In an opposite way to Skelet's work, the method is documented but, to the best of our knowledge, no code is made available, nor are the 900 claimed manual proofs, making verification of the result difficult apart from reproduction from scratch (arguably, verification would still be tedious if the 900 proofs were given).

The \BBfull problem was also studied in other models of computation than \rado's (c.f. Appendix~\ref{app:TMs}), including the \textit{quadruple} variation of Turing machines where each transition may move or write a new symbol, but not both \cite{Ross2003,Ross2005}. For additional historical perspective on the \BBfull problem, we refer the reader to Pascal Michel's survey and website \cite{michel2019busy,PMichel_website}.

\paragraph{Method and structure of the proof.} Machines are enumerated arborescently in \textit{Tree Normal Form} (TNF) \cite{Brady64} which drastically reduces the search space's size -- \eg from ca. 10 trillion machines to $\BBtheFifthTNF$ for 5-state machines. The enumeration is presented in Section~\ref{sec:enum}.

Each enumerated machine is fed through a sequence (or \textit{pipeline}) of \textit{deciders}, where a decider is an algorithm trying to decide whether the machine halts or not. Because of the noncomputability of the halting problem, there is no \textit{universal} decider able to decide any Turing machine. Hence, all the craft resides in creating deciders able to decide large families of machines, in reasonable time. The $S(5)$ pipeline of deciders is given in Table~\ref{tab:pipelineBB5} -- see Tab~\ref{tab:pipelineBB2x4} for $S(2,4)$. Deciders are presented in Section~\ref{sec:deciders}. To the best of our knowledge, all the deciders we present are original.

In the case of 5-state machines, \numSporadic machines were not solved by deciders and required individual proofs of nonhalting. We call them \textit{sporadic} machines and they are presented in Section~\ref{sec:sporadic}.

\paragraph{Meta-method: bbchallenge.org.}

\paragraph{Formal Verification (\CoqBB).} To the best of our knowledge, our work is the first to formally verify a \BBfull values.

\subsection{Discussion}
\subsection{Future Work}



\section{Turing machines enumeration}\label{sec:enum}
\section{Deciders}\label{sec:deciders}

A \textit{decider} is a program that takes as input a Turing machine $\mathcal{M}$ and that returns either \HALT, \NONHALT, \UNKNOWN whether it was able to detect that the machine's halting status (halt or nonhalt) or not.

\input{sections/decider-pipelines.tex}



\input{sections/decider-0-loops.tex}
% \input{sections/decider-1-translated-cyclers.tex}
\input{sections/decider-2-NGramCPS.tex}
\input{sections/decider-3-RepWL.tex}
\input{sections/decider-4-FAR.tex}
\input{sections/decider-5-MITM-WFAR.tex}

\section{Sporadic 5-state machines}\label{sec:sporadic}




\bibliographystyle{abbrv}
\newpage
\bibliography{bbchallenge-paper}

\appendix

\section{Turing machines}\label{app:TMs}
\section{Exact pipelines}\label{app:pipelines}
\section{Lower bounds}\label{app:lowerbounds}
\section{Cryptids}\label{app:cryptids}

\end{document}
